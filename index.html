<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Japanese Express - Bento Order</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üç±</text></svg>">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      background: #8B1A1A;
    }

    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      min-height: 100vh;
      background: linear-gradient(135deg, #fffbf5 0%, #fff5eb 50%, #fff0e6 100%);
      display: flex;
      flex-direction: column;
    }

    .bg-decor {
      position: absolute;
      inset: 0;
      pointer-events: none;
      background: 
        radial-gradient(circle at 20% 80%, rgba(139, 26, 26, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(196, 30, 58, 0.08) 0%, transparent 50%);
    }

    header {
      padding: 20px 28px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
      z-index: 10;
    }

    /* Splash Screen */
    .splash-screen {
      position: fixed;
      top: 0;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 480px;
      background: linear-gradient(135deg, #fffbf5 0%, #fff5eb 50%, #fff0e6 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 200;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    .splash-screen.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .splash-logo {
      width: 250px;
      height: 250px;
      object-fit: contain;
      margin-bottom: 20px;
      animation: pulse 2s ease-in-out infinite;
    }

    @media (min-width: 400px) {
      .splash-logo {
        width: 300px;
        height: 300px;
      }
    }

    .splash-title {
      font-size: 24px;
      font-weight: 700;
      color: #8B1A1A;
      margin-bottom: 8px;
      text-align: center;
    }

    .splash-school {
      font-size: 20px;
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 4px;
      text-align: center;
    }

    .splash-subtitle {
      font-size: 16px;
      color: #666;
      margin-bottom: 40px;
      text-align: center;
    }

    .splash-btn {
      background: linear-gradient(135deg, #8B1A1A, #C41E3A);
      color: white;
      border: none;
      padding: 18px 48px;
      font-size: 18px;
      font-weight: 600;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(139, 26, 26, 0.3);
      transition: all 0.3s ease;
    }

    .splash-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 25px rgba(139, 26, 26, 0.4);
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logo-icon {
      height: 40px;
      width: 40px;
      object-fit: contain;
    }

    .logo-text {
      font-size: 18px;
      font-weight: 600;
      color: #8B1A1A;
    }

    .progress-container {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .progress-bar {
      width: 100px;
      height: 5px;
      background: rgba(0,0,0,0.08);
      border-radius: 10px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #8B1A1A, #C41E3A);
      border-radius: 10px;
      transition: width 0.4s ease;
    }

    .step-indicator {
      font-size: 13px;
      color: #888;
      font-weight: 500;
    }

    main {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px 28px;
      position: relative;
      z-index: 10;
    }

    .question-container {
      max-width: 640px;
      width: 100%;
      transition: all 0.3s ease;
    }

    .question-container.animating {
      opacity: 0;
      transform: translateY(20px);
    }

    .step {
      display: none;
    }

    .step.active {
      display: block;
      animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .step-badge {
      display: inline-block;
      font-size: 14px;
      font-weight: 600;
      color: #8B1A1A;
      background: rgba(139, 26, 26, 0.1);
      padding: 6px 14px;
      border-radius: 20px;
      margin-bottom: 16px;
    }

    .step-title {
      font-size: 24px;
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 8px;
      line-height: 1.3;
    }

    .step-subtitle {
      font-size: 15px;
      color: #888;
      margin-bottom: 32px;
    }

    .step-subtitle-small {
      font-size: 13px;
      color: #888;
      margin-bottom: 16px;
    }

    .other-allergen-container {
      margin-top: 12px;
    }

    .other-allergen-input {
      font-size: 16px !important;
    }

    .text-input {
      width: 100%;
      font-size: 18px;
      padding: 16px 0;
      border: none;
      border-bottom: 2px solid #e0e0e0;
      background: transparent;
      outline: none;
      color: #1a1a1a;
      transition: border-color 0.3s ease;
    }

    .text-input:focus {
      border-color: #8B1A1A;
    }

    .text-input::placeholder {
      color: #ccc;
    }

    /* Bento Grid */
    .bento-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 14px;
      max-height: 380px;
      overflow-y: auto;
      padding: 4px;
    }

    /* Category Tabs */
    .category-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    .category-tab {
      flex: 1;
      padding: 12px 8px;
      border: 2px solid #e0e0e0;
      background: white;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      color: #666;
    }

    .category-tab.active {
      border-color: #8B1A1A;
      background: rgba(139, 26, 26, 0.08);
      color: #8B1A1A;
    }

    .category-desc {
      font-size: 12px;
      color: #888;
      margin-bottom: 12px;
      text-align: center;
    }

    /* Menu Grid */
    .menu-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      max-height: 320px;
      overflow-y: auto;
      padding: 4px;
    }

    .menu-card {
      background: rgba(255,255,255,0.9);
      border-radius: 12px;
      padding: 14px;
      cursor: pointer;
      border: 2px solid transparent;
      display: flex;
      align-items: center;
      gap: 12px;
      position: relative;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      transition: all 0.2s ease;
    }

    .menu-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .menu-card.selected {
      border-color: #8B1A1A;
      background: rgba(139, 26, 26, 0.08);
    }

    .menu-emoji {
      font-size: 28px;
      flex-shrink: 0;
    }

    .menu-info {
      flex: 1;
      min-width: 0;
    }

    .menu-name {
      font-size: 14px;
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 2px;
    }

    .menu-category {
      font-size: 11px;
      color: #888;
    }

    .menu-price {
      font-size: 15px;
      font-weight: 700;
      color: #8B1A1A;
      flex-shrink: 0;
    }

    .menu-check {
      position: absolute;
      top: 50%;
      right: 12px;
      transform: translateY(-50%);
      width: 24px;
      height: 24px;
      background: linear-gradient(135deg, #8B1A1A, #C41E3A);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 12px;
    }

    .bento-card {
      background: rgba(255,255,255,0.9);
      border-radius: 16px;
      padding: 18px;
      cursor: pointer;
      border: 2px solid transparent;
      position: relative;
      box-shadow: 0 2px 12px rgba(0,0,0,0.04);
      transition: all 0.2s ease;
    }

    .bento-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }

    .bento-card.selected {
      border-color: #8B1A1A;
      background: rgba(139, 26, 26, 0.08);
    }

    .popular-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: linear-gradient(135deg, #8B1A1A, #C41E3A);
      color: white;
      font-size: 9px;
      font-weight: 700;
      padding: 4px 8px;
      border-radius: 12px;
      text-transform: uppercase;
    }

    .bento-emoji {
      font-size: 36px;
      margin-bottom: 10px;
    }

    .bento-name {
      font-size: 14px;
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 2px;
    }

    .bento-name-jp {
      font-size: 11px;
      color: #aaa;
      margin-bottom: 8px;
    }

    .bento-desc {
      font-size: 11px;
      color: #666;
      line-height: 1.4;
      margin-bottom: 12px;
    }

    .bento-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .bento-price {
      font-size: 16px;
      font-weight: 700;
      color: #8B1A1A;
    }

    .bento-allergens {
      display: flex;
      gap: 4px;
    }

    .allergen-mini-tag {
      font-size: 8px;
      background: #f0f0f0;
      color: #888;
      padding: 2px 6px;
      border-radius: 8px;
      text-transform: uppercase;
    }

    .checkmark {
      position: absolute;
      top: 50%;
      right: 14px;
      transform: translateY(-50%);
      width: 28px;
      height: 28px;
      background: linear-gradient(135deg, #8B1A1A, #C41E3A);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 14px;
    }

    /* Allergen Grid */
    .allergen-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }

    .allergen-card {
      background: rgba(255,255,255,0.9);
      border-radius: 12px;
      padding: 14px;
      cursor: pointer;
      border: 2px solid transparent;
      display: flex;
      align-items: center;
      gap: 10px;
      position: relative;
      box-shadow: 0 2px 8px rgba(0,0,0,0.03);
      transition: all 0.2s ease;
    }

    .allergen-card:hover {
      transform: translateY(-1px);
    }

    .allergen-card.selected {
      border-color: #8B1A1A;
      background: rgba(139, 26, 26, 0.08);
    }

    .allergen-icon {
      font-size: 22px;
    }

    .allergen-name {
      font-size: 13px;
      font-weight: 500;
      color: #1a1a1a;
    }

    .allergen-check {
      position: absolute;
      right: 10px;
      color: #8B1A1A;
      font-weight: bold;
    }

    .allergen-warning {
      margin-top: 24px;
      padding: 14px 18px;
      background: rgba(255, 159, 67, 0.1);
      border-radius: 12px;
      font-size: 14px;
      color: #b45309;
    }

    /* Textarea */
    .text-area {
      width: 100%;
      font-size: 16px;
      padding: 16px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      background: rgba(255,255,255,0.8);
      outline: none;
      color: #1a1a1a;
      resize: vertical;
      min-height: 100px;
      font-family: inherit;
      transition: border-color 0.3s ease;
    }

    .text-area:focus {
      border-color: #8B1A1A;
    }

    .summary-card {
      margin-top: 28px;
      background: rgba(255,255,255,0.9);
      border-radius: 16px;
      padding: 18px;
      display: flex;
      align-items: center;
      gap: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.04);
    }

    .summary-emoji {
      font-size: 44px;
    }

    .summary-name {
      font-weight: 600;
      color: #1a1a1a;
    }

    .summary-meta {
      font-size: 14px;
      color: #888;
      margin-top: 4px;
    }

    /* Footer */
    footer {
      padding: 20px 28px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
      z-index: 10;
    }

    .btn {
      padding: 14px 28px;
      border-radius: 10px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-back {
      background: transparent;
      color: #888;
    }

    .btn-back:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .btn-next {
      background: linear-gradient(135deg, #1a1a1a, #333);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 2px;
    }

    .btn-next:disabled {
      background: #e0e0e0;
      color: #999;
      cursor: not-allowed;
    }

    .btn-shortcut {
      font-size: 10px;
      opacity: 0.7;
      font-weight: 400;
    }

    .btn-submit {
      padding: 16px 32px;
      background: linear-gradient(135deg, #8B1A1A, #C41E3A);
      color: white;
      box-shadow: 0 4px 16px rgba(139, 26, 26, 0.3);
    }

    .btn-submit:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(139, 26, 26, 0.4);
    }

    .btn-submit:disabled {
      background: #ccc;
      box-shadow: none;
      cursor: not-allowed;
    }

    /* Success Screen */
    .success-screen {
      display: none;
      text-align: center;
      padding: 60px 24px;
      max-width: 480px;
      margin: auto;
      position: relative;
      z-index: 10;
    }

    .success-screen.active {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    .success-icon {
      font-size: 56px;
      margin-bottom: 24px;
    }

    .success-title {
      font-size: 28px;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 12px;
    }

    .success-text {
      font-size: 16px;
      color: #666;
      margin-bottom: 40px;
    }

    .order-summary {
      background: rgba(255,255,255,0.9);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 32px;
      text-align: left;
      box-shadow: 0 4px 24px rgba(0,0,0,0.06);
    }

    .summary-title {
      font-size: 12px;
      font-weight: 600;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 16px;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid #f0f0f0;
      font-size: 15px;
    }

    .summary-row:last-child {
      border-bottom: none;
    }

    .summary-row.summary-total {
      border-top: 2px solid #8B1A1A;
      margin-top: 8px;
      padding-top: 16px;
    }

    .summary-row.summary-total .summary-label,
    .summary-row.summary-total .summary-value {
      font-size: 18px;
      font-weight: 700;
      color: #8B1A1A;
    }

    .summary-label {
      color: #888;
    }

    .summary-value {
      font-weight: 500;
      color: #1a1a1a;
    }

    .btn-restart {
      background: linear-gradient(135deg, #1a1a1a, #333);
      color: white;
    }

    /* Loading Overlay */
    .loading-overlay {
      display: none;
      position: fixed;
      top: 0;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 480px;
      background: rgba(255,255,255,0.9);
      z-index: 100;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      gap: 20px;
    }

    .loading-overlay.active {
      display: flex;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid #f0f0f0;
      border-top-color: #8B1A1A;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      font-size: 16px;
      color: #666;
    }

  </style>
</head>
<body>
  <div class="bg-decor"></div>

  <!-- Splash Screen -->
  <div class="splash-screen" id="splashScreen">
    <img src="JapaneseExpresssLogo.png" alt="Japanese Express" class="splash-logo">
    <p class="splash-school">Nokiidaa PS</p>
    <h1 class="splash-title">Sushi Lunch Order</h1>
    <p class="splash-subtitle">Pacific Mall ‚Ä¢ Second Floor Food Court</p>
    <button class="splash-btn" id="startBtn">Start Order ‚Üí</button>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <div class="loading-text">Submitting your order...</div>
  </div>

  <!-- Main Survey -->
  <div id="surveyContainer">
    <header>
      <div class="logo">
        <img src="JapaneseExpresssLogo.png" alt="Japanese Express" class="logo-icon">
        <span class="logo-text">Japanese Express</span>
      </div>
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <span class="step-indicator" id="stepIndicator">1 / 6</span>
      </div>
    </header>

    <main>
      <div class="question-container" id="questionContainer">
        
        <!-- Step 1: Teacher Name -->
        <div class="step active" data-step="0">
          <span class="step-badge">1 ‚Üí</span>
          <h2 class="step-title">What is the teacher's name?</h2>
          <input type="text" class="text-input" id="teacherName" placeholder="Teacher's full name" autofocus>
        </div>

        <!-- Step 2: Room Number -->
        <div class="step" data-step="1">
          <span class="step-badge">2 ‚Üí</span>
          <h2 class="step-title">What is your room number?</h2>
          <input type="text" class="text-input" id="roomNumber" placeholder="Room number">
        </div>

        <!-- Step 3: Student ID -->
        <div class="step" data-step="2">
          <span class="step-badge">3 ‚Üí</span>
          <h2 class="step-title">Student Last Name or ID</h2>
          <input type="text" class="text-input" id="studentId" placeholder="Last name or student ID">
        </div>

        <!-- Step 4: Menu Selection -->
        <div class="step" data-step="3">
          <span class="step-badge">4 ‚Üí</span>
          <h2 class="step-title">Choose your item</h2>
          
          <!-- Category Tabs -->
          <div class="category-tabs" id="categoryTabs">
            <button class="category-tab active" data-category="kimbap">üçô Samgak Kimbap</button>
            <button class="category-tab" data-category="rolls">üç£ Rolls</button>
          </div>
          <p class="category-desc" id="categoryDesc">Korean marinated rice with your choice of filling (1 piece)</p>
          
          <div class="menu-grid" id="menuGrid"></div>
        </div>

        <!-- Step 5: Allergens -->
        <div class="step" data-step="4">
          <span class="step-badge">5 ‚Üí</span>
          <h2 class="step-title">Any food allergies?</h2>
          <p class="step-subtitle-small">Select all that apply</p>
          <div class="allergen-grid" id="allergenGrid"></div>
          <div class="other-allergen-container" id="otherAllergenContainer" style="display: none;">
            <input type="text" class="text-input other-allergen-input" id="otherAllergenInput" placeholder="Please specify other allergies">
          </div>
          <div class="allergen-warning" id="allergenWarning" style="display: none;">
            ‚ö†Ô∏è We'll ensure your order avoids these ingredients
          </div>
        </div>

        <!-- Step 6: Contact Email -->
        <div class="step" data-step="5">
          <span class="step-badge">6 ‚Üí</span>
          <h2 class="step-title">Contact Email</h2>
          <p class="step-subtitle-small">For order confirmation</p>
          <input type="email" class="text-input" id="contactEmail" placeholder="Email address">
        </div>

        <!-- Step 7: Special Instructions -->
        <div class="step" data-step="6">
          <span class="step-badge">7 ‚Üí</span>
          <h2 class="step-title">Any special instructions?</h2>
          <p class="step-subtitle-small">Optional</p>
          <textarea class="text-area" id="specialInstructions" placeholder="Any special requests or notes"></textarea>
          <div class="summary-card" id="orderPreview"></div>
        </div>

      </div>
    </main>

    <footer>
      <button class="btn btn-back" id="btnBack" disabled>‚Üë Back</button>
      <button class="btn btn-next" id="btnNext">
        <span>OK ‚úì</span>
        <span class="btn-shortcut">press Enter ‚Üµ</span>
      </button>
      <button class="btn btn-submit" id="btnSubmit" style="display: none;">Submit Order üç±</button>
    </footer>
  </div>

  <!-- Success Screen -->
  <div class="success-screen" id="successScreen">
    <div class="success-icon">üéâ</div>
    <h1 class="success-title">Order Submitted!</h1>
    <p class="success-text">Thank you for your lunch order. You will receive a confirmation shortly.</p>
    <div class="order-summary" id="orderSummary"></div>
    <button class="btn btn-restart" id="btnRestart">Place Another Order</button>
  </div>

  <script>
    // ============================================
    // CONFIGURATION - UPDATE THIS URL
    // ============================================
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx0RWjzMiFeMg5rRM3jrKXRiKrA5PdFipRKoAtSNwf1MfUs-lyh2JLy7lM1Ceq_y7zidg/exec';
    // ============================================

    // Data
    const menuCategories = {
      kimbap: {
        name: 'Samgak Kimbap',
        description: 'Korean marinated rice with your choice of filling (1 piece)',
        items: [
          { id: 'kb-avocado-cucumber', name: 'Avocado & Cucumber', price: 4.00, category: 'Vegetarian', image: 'ü•ë' },
          { id: 'kb-cucumber', name: 'Cucumber', price: 4.00, category: 'Vegetarian', image: 'ü•í' },
          { id: 'kb-mango', name: 'Mango', price: 4.00, category: 'Vegetarian', image: 'ü•≠' },
          { id: 'kb-yam-tempura', name: 'Yam Tempura', price: 4.00, category: 'Vegetarian', image: 'üç†' },
          { id: 'kb-egg', name: 'Egg (Tamago)', price: 4.00, category: 'Vegetarian', image: 'ü•ö' },
          { id: 'kb-seaweed', name: 'Seaweed Salad', price: 4.00, category: 'Vegetarian', image: 'ü•ó' },
          { id: 'kb-chicken', name: 'Halal Chicken Teriyaki', price: 4.00, category: 'Halal & Cooked', image: 'üçó' },
          { id: 'kb-salmon-cooked', name: 'Salmon (Cooked) Teriyaki', price: 4.00, category: 'Cooked', image: 'üç£' },
          { id: 'kb-tuna-salad', name: 'Cooked Tuna Salad with Mayo', price: 4.00, category: 'Cooked', image: 'üêü' },
          { id: 'kb-crab-salad', name: 'Crab Salad (Imitation Crab)', price: 4.00, category: 'Cooked', image: 'ü¶Ä' },
          { id: 'kb-beef', name: 'Halal Beef Teriyaki', price: 4.00, category: 'Halal & Cooked', image: 'ü•©' },
          { id: 'kb-salmon-fresh', name: 'Salmon (Fresh)', price: 4.00, category: 'Fresh Seafood', image: 'üç£' },
          { id: 'kb-tuna-fresh', name: 'Tuna (Fresh)', price: 4.00, category: 'Fresh Seafood', image: 'üêü' },
          { id: 'kb-shrimp', name: 'Crispy Shrimp Tempura', price: 4.00, category: 'Cooked', image: 'üç§' }
        ]
      },
      rolls: {
        name: 'Rolls',
        description: '8 pieces with white sushi rice on the outside',
        items: [
          { id: 'rl-avocado-cucumber', name: 'Avocado & Cucumber Roll', price: 5.50, category: 'Vegetarian', image: 'ü•ë' },
          { id: 'rl-cucumber', name: 'Cucumber Roll', price: 5.00, category: 'Vegetarian', image: 'ü•í' },
          { id: 'rl-mango', name: 'Mango Roll', price: 5.00, category: 'Vegetarian', image: 'ü•≠' },
          { id: 'rl-yam-tempura', name: 'Yam Tempura Roll', price: 5.50, category: 'Vegetarian', image: 'üç†' },
          { id: 'rl-egg', name: 'Egg (Tamago) Roll', price: 5.00, category: 'Vegetarian', image: 'ü•ö' },
          { id: 'rl-seaweed', name: 'Seaweed Salad Roll', price: 5.00, category: 'Vegetarian', image: 'ü•ó' },
          { id: 'rl-chicken', name: 'Halal Chicken Teriyaki Roll', price: 6.00, category: 'Halal & Cooked', image: 'üçó' },
          { id: 'rl-california', name: 'California Roll', price: 6.00, category: 'Cooked', image: 'üç£' },
          { id: 'rl-crab-salad', name: 'Crab Salad Roll (Imitation)', price: 5.50, category: 'Cooked', image: 'ü¶Ä' },
          { id: 'rl-beef', name: 'Halal Beef Bulgogi Roll', price: 6.00, category: 'Halal & Cooked', image: 'ü•©' },
          { id: 'rl-salmon-fresh', name: 'Salmon (Fresh) Roll', price: 6.00, category: 'Fresh Seafood', image: 'üç£' },
          { id: 'rl-tuna-fresh', name: 'Tuna (Fresh) Roll', price: 6.00, category: 'Fresh Seafood', image: 'üêü' },
          { id: 'rl-shrimp', name: 'Crispy Shrimp Tempura Roll', price: 5.50, category: 'Cooked', image: 'üç§' }
        ]
      }
    };

    const bentoMenus = [
      { id: 'teriyaki', name: 'Teriyaki Chicken Bento', nameJp: 'ÁÖß„ÇäÁÑº„Åç„ÉÅ„Ç≠„É≥ÂºÅÂΩì', price: 12.99, description: 'Grilled chicken with sweet teriyaki glaze, steamed rice, edamame, and pickled vegetables', image: 'üçó', popular: true, allergens: ['soy', 'sesame', 'wheat'] },
      { id: 'salmon', name: 'Grilled Salmon Bento', nameJp: 'ÁÑº„ÅçÈÆ≠ÂºÅÂΩì', price: 14.99, description: 'Norwegian salmon fillet with miso glaze, jasmine rice, seaweed salad, and tamagoyaki', image: 'üç£', popular: true, allergens: ['fish', 'soy', 'egg', 'sesame'] },
      { id: 'katsu', name: 'Chicken Katsu Bento', nameJp: '„ÉÅ„Ç≠„É≥„Ç´„ÉÑÂºÅÂΩì', price: 13.49, description: 'Crispy panko-breaded chicken cutlet with tonkatsu sauce, rice, and coleslaw', image: 'üç±', popular: false, allergens: ['wheat', 'egg', 'soy'] },
      { id: 'veggie', name: 'Vegetable Tempura Bento', nameJp: 'ÈáéËèúÂ§©„Å∑„ÇâÂºÅÂΩì', price: 11.99, description: 'Assorted seasonal vegetables in light tempura batter with tentsuyu dipping sauce', image: 'ü•¨', popular: false, allergens: ['wheat', 'soy'] },
      { id: 'gyudon', name: 'Gyudon Beef Bowl', nameJp: 'Áâõ‰∏º', price: 13.99, description: 'Thinly sliced beef simmered with onions in sweet soy broth over fluffy rice', image: 'ü•©', popular: true, allergens: ['soy', 'wheat'] },
      { id: 'tofu', name: 'Tofu Teriyaki Bento', nameJp: 'Ë±ÜËÖêÁÖß„ÇäÁÑº„ÅçÂºÅÂΩì', price: 10.99, description: 'Crispy tofu with teriyaki glaze, brown rice, steamed broccoli, and pickles', image: 'ü´ò', popular: false, allergens: ['soy', 'sesame', 'wheat'] }
    ];

    const allergensList = [
      { id: 'wheat', name: 'Wheat/Gluten', icon: 'üåæ' },
      { id: 'soy', name: 'Soy', icon: 'ü´ò' },
      { id: 'egg', name: 'Eggs', icon: 'ü•ö' },
      { id: 'fish', name: 'Fish', icon: 'üêü' },
      { id: 'shellfish', name: 'Shellfish', icon: 'ü¶ê' },
      { id: 'sesame', name: 'Sesame', icon: '‚ö™' },
      { id: 'peanuts', name: 'Peanuts', icon: 'ü•ú' },
      { id: 'treenuts', name: 'Tree Nuts', icon: 'üå∞' },
      { id: 'dairy', name: 'Dairy', icon: 'ü•õ' },
      { id: 'other', name: 'Other', icon: 'üìù' },
      { id: 'none', name: 'No Allergies', icon: '‚úì' }
    ];

    // State
    let currentStep = 0;
    const totalSteps = 7;
    let selectedCategory = 'kimbap';
    let formData = {
      teacherName: '',
      roomNumber: '',
      studentId: '',
      selectedCategory: null,
      selectedItem: null,
      allergens: [],
      otherAllergen: '',
      contactEmail: '',
      specialInstructions: ''
    };

    // DOM Elements
    const progressFill = document.getElementById('progressFill');
    const stepIndicator = document.getElementById('stepIndicator');
    const questionContainer = document.getElementById('questionContainer');
    const btnBack = document.getElementById('btnBack');
    const btnNext = document.getElementById('btnNext');
    const btnSubmit = document.getElementById('btnSubmit');
    const surveyContainer = document.getElementById('surveyContainer');
    const successScreen = document.getElementById('successScreen');
    const loadingOverlay = document.getElementById('loadingOverlay');

    // Splash screen
    document.getElementById('startBtn').addEventListener('click', () => {
      document.getElementById('splashScreen').classList.add('hidden');
      setTimeout(() => {
        document.getElementById('teacherName').focus();
      }, 500);
    });

    // Initialize
    function init() {
      renderMenuGrid();
      setupCategoryTabs();
      renderAllergenGrid();
      updateProgress();
      setupEventListeners();
    }

    function setupCategoryTabs() {
      document.querySelectorAll('.category-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          selectedCategory = tab.dataset.category;
          document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          document.getElementById('categoryDesc').textContent = menuCategories[selectedCategory].description;
          formData.selectedItem = null;
          formData.selectedCategory = null;
          renderMenuGrid();
          updateButtons();
        });
      });
    }

    function renderMenuGrid() {
      const grid = document.getElementById('menuGrid');
      const items = menuCategories[selectedCategory].items;
      
      grid.innerHTML = items.map(item => `
        <div class="menu-card" data-id="${item.id}" data-category="${selectedCategory}">
          <span class="menu-emoji">${item.image}</span>
          <div class="menu-info">
            <div class="menu-name">${item.name}</div>
            <div class="menu-category">${item.category}</div>
          </div>
          <span class="menu-price">$${item.price.toFixed(2)}</span>
        </div>
      `).join('');

      grid.querySelectorAll('.menu-card').forEach(card => {
        card.addEventListener('click', () => selectMenuItem(card.dataset.id, card.dataset.category));
      });
    }

    function selectMenuItem(itemId, category) {
      formData.selectedItem = itemId;
      formData.selectedCategory = category;
      
      document.querySelectorAll('.menu-card').forEach(card => {
        card.classList.remove('selected');
        card.querySelector('.menu-check')?.remove();
      });
      
      const selected = document.querySelector(`.menu-card[data-id="${itemId}"]`);
      selected.classList.add('selected');
      selected.innerHTML += '<div class="menu-check">‚úì</div>';
      updateButtons();
    }

    function getSelectedItem() {
      if (!formData.selectedItem || !formData.selectedCategory) return null;
      return menuCategories[formData.selectedCategory].items.find(item => item.id === formData.selectedItem);
    }

    function renderBentoGrid() {
      const grid = document.getElementById('bentoGrid');
      if (!grid) return;
    }

    function renderAllergenGrid() {
      const grid = document.getElementById('allergenGrid');
      grid.innerHTML = allergensList.map(allergen => `
        <div class="allergen-card" data-id="${allergen.id}">
          <span class="allergen-icon">${allergen.icon}</span>
          <span class="allergen-name">${allergen.name}</span>
        </div>
      `).join('');

      grid.querySelectorAll('.allergen-card').forEach(card => {
        card.addEventListener('click', () => toggleAllergen(card.dataset.id));
      });
    }

    function selectBento(id) {
      formData.selectedBento = id;
      document.querySelectorAll('.bento-card').forEach(card => {
        card.classList.remove('selected');
        card.querySelector('.checkmark')?.remove();
      });
      const selected = document.querySelector(`.bento-card[data-id="${id}"]`);
      selected.classList.add('selected');
      selected.innerHTML += '<div class="checkmark">‚úì</div>';
      updateButtons();
    }

    function toggleAllergen(id) {
      if (id === 'none') {
        formData.allergens = ['none'];
        formData.otherAllergen = '';
        document.getElementById('otherAllergenInput').value = '';
      } else {
        if (formData.allergens.includes(id)) {
          formData.allergens = formData.allergens.filter(a => a !== id);
          if (id === 'other') {
            formData.otherAllergen = '';
            document.getElementById('otherAllergenInput').value = '';
          }
        } else {
          formData.allergens = [...formData.allergens.filter(a => a !== 'none'), id];
        }
      }
      updateAllergenUI();
      updateButtons();
    }

    function updateAllergenUI() {
      document.querySelectorAll('.allergen-card').forEach(card => {
        const id = card.dataset.id;
        card.classList.toggle('selected', formData.allergens.includes(id));
        card.querySelector('.allergen-check')?.remove();
        if (formData.allergens.includes(id)) {
          card.innerHTML += '<span class="allergen-check">‚úì</span>';
        }
      });
      const warning = document.getElementById('allergenWarning');
      warning.style.display = formData.allergens.length > 0 && !formData.allergens.includes('none') ? 'block' : 'none';
      
      // Show/hide other allergen input
      const otherContainer = document.getElementById('otherAllergenContainer');
      otherContainer.style.display = formData.allergens.includes('other') ? 'block' : 'none';
    }

    function setupEventListeners() {
      btnBack.addEventListener('click', goBack);
      btnNext.addEventListener('click', goNext);
      btnSubmit.addEventListener('click', submitForm);
      document.getElementById('btnRestart').addEventListener('click', restart);

      // Input listeners
      document.getElementById('teacherName').addEventListener('input', (e) => {
        formData.teacherName = e.target.value;
        updateButtons();
      });
      document.getElementById('roomNumber').addEventListener('input', (e) => {
        formData.roomNumber = e.target.value;
        updateButtons();
      });
      document.getElementById('studentId').addEventListener('input', (e) => {
        formData.studentId = e.target.value;
        updateButtons();
      });
      document.getElementById('specialInstructions').addEventListener('input', (e) => {
        formData.specialInstructions = e.target.value;
      });
      document.getElementById('contactEmail').addEventListener('input', (e) => {
        formData.contactEmail = e.target.value;
        updateButtons();
      });
      document.getElementById('otherAllergenInput').addEventListener('input', (e) => {
        formData.otherAllergen = e.target.value;
      });

      // Enter key navigation
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && canProceed()) {
          e.preventDefault();
          if (currentStep < totalSteps - 1) {
            goNext();
          } else {
            submitForm();
          }
        }
      });
    }

    function canProceed() {
      switch (currentStep) {
        case 0: return formData.teacherName.trim().length > 0;
        case 1: return formData.roomNumber.trim().length > 0;
        case 2: return formData.studentId.trim().length > 0;
        case 3: return formData.selectedItem !== null;
        case 4: return formData.allergens.length > 0;
        case 5: return formData.contactEmail.trim().length > 0 && formData.contactEmail.includes('@');
        case 6: return true;
        default: return false;
      }
    }

    function updateButtons() {
      btnBack.disabled = currentStep === 0;
      btnNext.disabled = !canProceed();
      
      if (currentStep === totalSteps - 1) {
        btnNext.style.display = 'none';
        btnSubmit.style.display = 'block';
      } else {
        btnNext.style.display = 'flex';
        btnSubmit.style.display = 'none';
      }
    }

    function updateProgress() {
      const progress = ((currentStep + 1) / totalSteps) * 100;
      progressFill.style.width = `${progress}%`;
      stepIndicator.textContent = `${currentStep + 1} / ${totalSteps}`;
    }

    function showStep(step) {
      document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
      document.querySelector(`.step[data-step="${step}"]`).classList.add('active');
      
      // Focus input if present
      const input = document.querySelector(`.step[data-step="${step}"] .text-input`);
      if (input) setTimeout(() => input.focus(), 100);

      // Update order preview on last step (step 7, index 6)
      if (step === 6) {
        updateOrderPreview();
      }
    }

    function updateOrderPreview() {
      const item = getSelectedItem();
      const categoryName = formData.selectedCategory === 'kimbap' ? 'Samgak Kimbap' : 'Roll';
      document.getElementById('orderPreview').innerHTML = `
        <span class="summary-emoji">${item?.image || 'üçô'}</span>
        <div>
          <div class="summary-name">${item?.name || 'No item selected'}</div>
          <div class="summary-meta">${categoryName} ‚Ä¢ For ${formData.studentId} ‚Ä¢ Room ${formData.roomNumber}</div>
        </div>
      `;
    }

    function goNext() {
      if (currentStep < totalSteps - 1 && canProceed()) {
        questionContainer.classList.add('animating');
        setTimeout(() => {
          currentStep++;
          showStep(currentStep);
          updateProgress();
          updateButtons();
          questionContainer.classList.remove('animating');
        }, 300);
      }
    }

    function goBack() {
      if (currentStep > 0) {
        questionContainer.classList.add('animating');
        setTimeout(() => {
          currentStep--;
          showStep(currentStep);
          updateProgress();
          updateButtons();
          questionContainer.classList.remove('animating');
        }, 300);
      }
    }

    async function submitForm() {
      loadingOverlay.classList.add('active');

      const item = getSelectedItem();
      const categoryName = formData.selectedCategory === 'kimbap' ? 'Samgak Kimbap' : 'Roll';
      
      // Build allergens string including other if specified
      let allergensStr = formData.allergens.join(', ');
      if (formData.allergens.includes('other') && formData.otherAllergen.trim()) {
        allergensStr = allergensStr.replace('other', `Other: ${formData.otherAllergen}`);
      }
      
      const submission = {
        timestamp: new Date().toISOString(),
        teacherName: formData.teacherName,
        roomNumber: formData.roomNumber,
        studentId: formData.studentId,
        contactEmail: formData.contactEmail,
        category: categoryName,
        itemName: item?.name || '',
        itemPrice: item?.price || 0,
        allergens: allergensStr,
        specialInstructions: formData.specialInstructions
      };

      try {
        const response = await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(submission)
        });

        showSuccess(submission);
      } catch (error) {
        console.error('Submission error:', error);
        alert('There was an error submitting your order. Please try again.');
      } finally {
        loadingOverlay.classList.remove('active');
      }
    }

    function showSuccess(data) {
      surveyContainer.style.display = 'none';
      successScreen.classList.add('active');

      document.getElementById('orderSummary').innerHTML = `
        <h3 class="summary-title">Order Summary</h3>
        <div class="summary-row">
          <span class="summary-label">Teacher</span>
          <span class="summary-value">${data.teacherName}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Room</span>
          <span class="summary-value">${data.roomNumber}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Student</span>
          <span class="summary-value">${data.studentId}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Email</span>
          <span class="summary-value">${data.contactEmail}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Item</span>
          <span class="summary-value">${data.itemName}</span>
        </div>
        <div class="summary-row summary-total">
          <span class="summary-label">Total</span>
          <span class="summary-value">$${data.itemPrice.toFixed(2)}</span>
        </div>
      `;
    }

    function restart() {
      currentStep = 0;
      selectedCategory = 'kimbap';
      formData = {
        teacherName: '',
        roomNumber: '',
        studentId: '',
        selectedCategory: null,
        selectedItem: null,
        allergens: [],
        otherAllergen: '',
        contactEmail: '',
        specialInstructions: ''
      };

      // Reset inputs
      document.getElementById('teacherName').value = '';
      document.getElementById('roomNumber').value = '';
      document.getElementById('studentId').value = '';
      document.getElementById('contactEmail').value = '';
      document.getElementById('specialInstructions').value = '';
      document.getElementById('otherAllergenInput').value = '';

      // Reset category tabs
      document.querySelectorAll('.category-tab').forEach(tab => {
        tab.classList.remove('active');
        if (tab.dataset.category === 'kimbap') tab.classList.add('active');
      });
      document.getElementById('categoryDesc').textContent = menuCategories.kimbap.description;

      // Reset menu selection
      renderMenuGrid();

      // Reset allergens
      document.querySelectorAll('.allergen-card').forEach(card => {
        card.classList.remove('selected');
        card.querySelector('.allergen-check')?.remove();
      });
      document.getElementById('allergenWarning').style.display = 'none';
      document.getElementById('otherAllergenContainer').style.display = 'none';

      // Show splash screen
      document.getElementById('splashScreen').classList.remove('hidden');
      
      // Hide success, show survey
      successScreen.classList.remove('active');
      surveyContainer.style.display = 'block';
      showStep(0);
      updateProgress();
      updateButtons();
    }

    // Start
    init();
  </script>
</body>
</html>
